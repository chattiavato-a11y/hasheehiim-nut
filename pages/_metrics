# Add "export const dynamic = 'error'" once near the top (after imports)
if ! grep -q "export const dynamic = 'error'" pages/index.tsx; then
  line_after_imports="$(awk '/^import /{last=NR} END{print (last?last:0)}' pages/index.tsx)"
  if [ "$line_after_imports" -gt 0 ]; then
    awk -v n="$line_after_imports" 'NR==n{print; print "export const dynamic = '\''error'\'';"; next}1' pages/index.tsx > pages/index.tsx.tmp && mv pages/index.tsx.tmp pages/index.tsx
  else
    sed -i "1i export const dynamic = 'error';" pages/index.tsx
  fi
fi

# Rename declaration: const/let/var metrics â†’ _metrics
sed -i -E 's/\b(const|let|var)\s+metrics\b/\1 _metrics/g' pages/index.tsx
